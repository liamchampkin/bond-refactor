var exec, fs, spawn, _ref;

_ref = require('child_process'), spawn = _ref.spawn, exec = _ref.exec;

fs = require('fs');

module.exports = function(template, locals, callback) {
  var command, json;
  if (typeof locals === "function") {
    callback = locals;
    locals = {};
  }
  locals || (locals = {});
  command = spawn('ruby', ["" + __dirname + "/index.rb"]);
  json = JSON.stringify({
    template: template,
    locals: locals
  });
  command.stdout.setEncoding('utf8');
  command.stdout.on('data', function(data) {
    return callback(null, data.toString().trim());
  });
  command.stdout.setEncoding('utf8');
  command.stderr.on('data', function(data) {
    return callback(data.toString().trim(), null);
  });
  command.stdin.write(json);
  return command.stdin.end();
};
